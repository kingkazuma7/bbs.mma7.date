# 🥋 格闘技掲示板プロジェクト 開発・デプロイ指示書（Google認証後回しミニマム版）

**目的**: Laravelとmixhostを利用し、大会ごと・選手ごとのスレッド型掲示板を、匿名投稿機能付きで実現する。

## ステップ 1: ローカル開発環境の準備

| No. | 作業項目               | コマンド/内容                                            | 備考                                                |
|-----|------------------------|----------------------------------------------------------|-----------------------------------------------------|
| 1-1 | Laravelプロジェクト作成 | `composer create-project --prefer-dist laravel/laravel {プロジェクト名}` |                                                     |
| 1-2 | DB接続設定             | `.env` ファイルにローカルの MySQL/MariaDB 接続情報を設定 | mixhostと合わせるため                               |

## ステップ 2: データベース設計（コア機能）

| No. | 作業項目                                     | コマンド/内容                                         | 備考                                                      |
|-----|----------------------------------------------|-------------------------------------------------------|-----------------------------------------------------------|
| 2-1 | 基本テーブル作成 (Model & Migration)         | `php artisan make:model Event -m`                     | 大会情報                                                  |
| 2-2 |                                              | `php artisan make:model Fighter -m`                   | 選手情報                                                  |
| 2-3 |                                              | `php artisan make:model Thread -m`                    | スレッド情報（`event_id`, `fighter_id` を NULL 許容で設定） |
| 2-4 | 投稿テーブル作成 (Migration)                 | `php artisan make:model Post -m`                      |                                                           |
| 2-5 | `posts`テーブル定義                           | `thread_id` (外部キー), `message`, `string('name')` を追加 | 匿名名 (`name`) のみを必須または NULL 許容で設定          |
| 2-6 | マイグレーション実行                         | `php artisan migrate`                                 |                                                           |
| 2-7 | リレーションシップ定義                       | `Event`, `Fighter`, `Thread`, `Post` モデル間のリレーション (`hasMany`, `belongsTo`) を定義 |                                                           |
| 2-8 | テストデータ作成                         | `php artisan make:factory EventFactory` など、各モデルのファクトリを作成 |                                                           |
| 2-9 | 初期データ投入                         | FactoryとSeederを使って、ダミーの大会、選手、スレッドデータをDBに投入 | 開発中に画面表示をすぐに確認できるため、効率が大幅に向上します|

## ステップ 3: アプリケーションロジックと匿名投稿実装

| No. | 作業項目               | コマンド/内容                                                    | 備考                                                                                             |
|-----|------------------------|------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
| 3-1 | コントローラー作成     | `php artisan make:controller EventController` など、計4つのコントローラーを作成 |                                                                                                  |
| 3-2 | ルーティング定義       | `routes/web.php` にリソースルートやカスタムルートを定義          | `/events`, `/fighters/{id}/threads`, `/threads/{id}` など                                        |
| 3-3 | ビュー作成 (Blade)     | リスト、詳細、投稿フォームのテンプレートを作成                   |                                                                                                  |
| 3-4 | 匿名投稿ロジック       | `PostController@store` メソッドを実装                            | フォームからの `message` と `name` を受け取り、バリデーション後にDBに保存                        |
| 3-5 | 投稿表示               | 投稿一覧表示時、`Post`モデルから取得した**name**（匿名名）と`message`を表示 |                                                                                                  |

## ステップ 4: mixhostへのデプロイ

| No. | 作業項目                 | コマンド/内容                                                    | 備考                                                                   |
|-----|--------------------------|------------------------------------------------------------------|------------------------------------------------------------------------|
| 4-1 | mixhost契約・DB作成      | MySQL/MariaDBデータベースを作成し、認証情報を取得                |                                                                        |
| 4-2 | .env更新                 | mixhostのDB情報と、`APP_URL=https://あなたのドメイン` を設定       |                                                                        |
| 4-3 | ファイルアップロード     | プロジェクト全体をアップロード（FTPまたはGit）                   | 🚨 難易度高: `public`ディレクトリの内容をドキュメントルートに配置する設定が必須 |
| 4-4 | 依存関係インストール     | SSHでサーバーに接続し、`composer install` を実行                |                                                                        |
| 4-5 | DB反映                   | SSHで `php artisan migrate` を実行                               |                                                                        |
| 4-6 | キャッシュクリア         | SSHで `php artisan config:cache` および `php artisan view:clear` を実行 |                                                                        |
| 4-7 | 動作確認                 | Webブラウザでサイトにアクセスし、匿名投稿機能が動くか確認        |                                                                        |

## ➕ Google認証を後で追加する場合のメモ（ステップ 5）

| No. | 作業項目             | コマンド/内容                                            | 備考                                                               |
|-----|----------------------|----------------------------------------------------------|--------------------------------------------------------------------|
| 5-1 | 認証基盤導入         | `composer require laravel/breeze --dev` およびセットアップ |                                                                    |
| 5-2 | Socialite導入        | `composer require laravel/socialite`                     |                                                                    |
| 5-3 | DB改修               | `posts`テーブルに `user_id` カラムを追加するマイグレーションを実行 |                                                                    |
| 5-4 | ロジック改修         | `PostController`を修正し、ログイン時と匿名時で保存するカラムを分岐させる |                                                                    |
